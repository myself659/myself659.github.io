<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>关于区块链共识的一些思考 | 沉风网事</title><meta name=keywords content="Distributed,BlockChain"><meta name=description content="说明 前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。 定义"><meta name=author content="沉风"><link rel=canonical href=https://myself659.github.io/post/blockchain/%E5%85%B3%E4%BA%8E%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://myself659.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://myself659.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://myself659.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://myself659.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://myself659.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-144475213-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="关于区块链共识的一些思考"><meta property="og:description" content="说明 前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。 定义"><meta property="og:type" content="article"><meta property="og:url" content="https://myself659.github.io/post/blockchain/%E5%85%B3%E4%BA%8E%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"><meta property="og:image" content="https://myself659.github.io/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-12-24T11:58:06+02:00"><meta property="article:modified_time" content="2018-12-24T11:58:06+02:00"><meta property="og:site_name" content="沉风网事"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://myself659.github.io/"><meta name=twitter:title content="关于区块链共识的一些思考"><meta name=twitter:description content="说明 前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。 定义"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://myself659.github.io/post/"},{"@type":"ListItem","position":2,"name":"关于区块链共识的一些思考","item":"https://myself659.github.io/post/blockchain/%E5%85%B3%E4%BA%8E%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"关于区块链共识的一些思考","name":"关于区块链共识的一些思考","description":"说明 前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。 定义","keywords":["Distributed","BlockChain"],"articleBody":"说明 前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。\n定义 区块链是什么？这个问题有太多的回答。\n区块链是一个由全体联网节点共同维护并持有同一账本的分布式数据库，它通过算法来达成共识，在无需信任的各节点中构建一个无单一故障点或控制点的去中心化可信系统\n所以在技术上区块链的本质是分布式帐本技术(DLT)。\n重要性 Why Decentralization Matters这篇文章从互联网发展历程与面临问题说明去中心化重要性。\n去中心化重要性来自去中心化带来的影响与作用，具体如下：\n去中心化可以降低垄断的可能性，是一种对抗垄断的重要方式 去中心化提供高可用性 去中心化对抗DDos 去中心化可以让人人参与，权力下放 去中心化是让数据归还用户，保护隐私的重要技术手段之一 去中心化消除中间环节，提高效率 去中心化与中心化并不是对立，可以相互补充 去中心化能够解决中心化无法解决的问题，如微信流控算法，并没有采用全局，而由节点根据延迟参数调整，另外是5G带来的高速传输与海量数据需要去中心化来来解决 去中心化解决问题 提供全球开放的分布式数据 提供不可更改的数据库 提供trustless的基础设施 基于以上三点的业务的需求 思考模型 如同前面的分布式系统一样，对于公链（去中心化系统）问题，也可以分为以下几个子问题：\n在什么环境下？ 有哪些节点参与？ 通过什么样的共识算法？ 使什么业务？ 达成什么样的容错要求？ 总结一句话：在什么环境下，有哪些节点参与，通过什么样的共识算法，使什么业务达成什么样的容错要求。\n下面就这五个问题展开说明。\n环境 大部分去中心化系统的环境要点如下：\n异步网络模型 网络结构是P2P网络 网络传输是不可靠的 系统异常是常态 并发 缺少全局时钟 (Ps:这里不展开说明了，谈谈对分布式系统的一些思考)\n节点 节点准入方面 节点自由加入与退出 节点需要通过PoW测试才能加入 节点需要PoS持仓才能加入 节点需要质押才能加入 节点角色 节点平等，无角色任何差异如比特币 节点分为超级节点，见证节点如EOS 节点数量 不限数量，如比特币，以太坊 指定数量，如EOS指定为21，steemit指定数量为11 节点可信 存在不可信的作恶节点 可信节点（算力）一定多于作恶节点（算力） 节点配置 机器性能波动大 网络带宽波动大 节点分布在全球各地 节点配置不受控 节点之间差异大如算力，POS投票权重 节点经济原则 99.99%以上节点是趋利 节点受激励引导 节点受惩罚限制 节点之间存在博弈与竞争 节点不会作出投入成本大于产出收益的选择 共识算法 一定要摆脱传统分布式思想的限制。要在经济，竞争，博弈，协议等多方面有效结合。\n从上图可以看出，传统分布式共识算法在整个共识里面只占很小一部分。 共识算法是区块链技术上的核心。\n不得不说，PoW是另一种形式实现拜占庭容错，是比特币最大的亮点。\n属性 一个科学共识算法必须同时满足以下四个属性：\nAgreement Validity Integrity Termination 这四个属性从四个方面规范共识算法的要求，也为我们提供分析共识算法四个不同的视角。\nAgreement Every correct process must agree on the same value.\n这是实现一致性必须要做到的要求：每个节点必须达成一致。 bitcoin通过以下几点实现该属性，具体如下：\n在选主方面选择最强算力原则，保证具体高度的区块的一致性（以最快算出的为准） 在链分叉情况下选择最长链，解决网络分化等原因可能出现的分叉问题 Validity If all the correct processes proposed the same value v, then any correct process must decide v.\nValidity是为了防止这种情况的出现：一些节点无论提议什么值，本节点一直提交NULL。在bitcoin这种行为可以理解为自私挖矿行为。\nbitcoin通过以下几点实现该属性，具体如下：\n算力不可复制 随机性加大自私挖矿的成本 最长链确认由各节点自行确认 时间戳确认 Integrity No Node decides twice.\n保证共识得到一致性不可逆，不可被修改。那么在这成共识过程中有许多操作需要进行限制。 bitcoin通过以下几点实现该属性，具体如下：\n链式结构 算力要求 难度提升 多节点竞争 Termination Eventually, every correct process decides some value.\nTermination是一个liveness属性，bitcoin通过以下几点实现该属性，具体如下：\n通过激励吸引大量节点参与，保证有节点来完成出块 出块时间周期设置10分钟 业务 去中心化带来业务的形态的变化，现列举部分业务如下：\n去中心化交易所 去中心化网络平台 去中心化计算平台 去中心化存储 去中心化CDN 去中心化数字货币 去中心化协议 去中心化跨链 去中心化金融科技DeFi 去中心化通信 容错要求 对于去中心化系统，对应的容错要求是DCS定理。\nDCS定理 如同CAP定理一样，DCS定理是指在一个公有链系统中不可能同时满足以下三个条件：去中心化（Decentralized）、一致性（Consistency）和可扩展性（Scale）。\n去中心化 去中心化是指任意节点可以加入与退出，整个网络不受任何人控制。\n一致性 与上面CAP的一致性类似，不过应用中更加偏重安全如防范双花攻击。\n可扩展性 可扩展性是指TPS能够实现提高。\n关于DCS这三者之间的tradeoff，更多参考The DCS Triangle\n小结 区块链的共识现在还处于探索阶段，并不像分布式系统共识（不考虑拜占庭问题）已经成熟。区块链的共识在不断探索与发展中，未来会有更多的新型共识出来。\n参考 Why Decentralization Matters The DCS Triangle SoK: Consensus in the age of blockchains DAGOR：微信微服务过载控制系统 A Brief Tour of FLP Impossibility Agreement with Satoshi – On the Formalization of Nakamoto Consensus Yuval Noah Harari: Why fascism is so tempting and how your data could power it | TED Talk Tech C.E.O.s Are in Love With Their Principal Doomsayer 谈谈对分布式系统的一些思考 Algorand’s Instant Consensus Protocol 区块链到底有什么了不起 BitTorrent 公有链的基本挑战 Blockchains don’t scale. Not today, at least. But there’s hope. Consensus Protocols of Distributed Ledger Technology ","wordCount":"2238","inLanguage":"zh","datePublished":"2018-12-24T11:58:06+02:00","dateModified":"2018-12-24T11:58:06+02:00","author":{"@type":"Person","name":"沉风"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://myself659.github.io/post/blockchain/%E5%85%B3%E4%BA%8E%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"},"publisher":{"@type":"Organization","name":"沉风网事","logo":{"@type":"ImageObject","url":"https://myself659.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://myself659.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://myself659.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://myself659.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://myself659.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://myself659.github.io/search/ title=Search><span>Search</span></a></li><li><a href=https://myself659.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://myself659.github.io/about/ title=About><span>About</span></a></li><li><a href=https://myself659.github.io/post/leetcode/ title=LeetCode><span>LeetCode</span></a></li><li><a href=https://myself659.github.io/post/read-post/ title=Reading><span>Reading</span></a></li><li><a href=https://myself659.github.io/post/share-post/ title=Share><span>Share</span></a></li><li><a href=https://myself659.github.io/post/slide-post/ title=Slide><span>Slide</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://myself659.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://myself659.github.io/post/>Posts</a></div><h1 class=post-title>关于区块链共识的一些思考</h1><div class=post-meta><span title='2018-12-24 11:58:06 +0200 +0200'>2018-12-24</span>&nbsp;·&nbsp;沉风</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e8%af%b4%e6%98%8e aria-label=说明>说明</a></li><li><a href=#%e5%ae%9a%e4%b9%89 aria-label=定义>定义</a></li><li><a href=#%e9%87%8d%e8%a6%81%e6%80%a7 aria-label=重要性>重要性</a></li><li><a href=#%e5%8e%bb%e4%b8%ad%e5%bf%83%e5%8c%96%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98 aria-label=去中心化解决问题>去中心化解决问题</a></li><li><a href=#%e6%80%9d%e8%80%83%e6%a8%a1%e5%9e%8b aria-label=思考模型>思考模型</a><ul><li><a href=#%e7%8e%af%e5%a2%83 aria-label=环境>环境</a></li><li><a href=#%e8%8a%82%e7%82%b9 aria-label=节点>节点</a><ul><li><a href=#%e8%8a%82%e7%82%b9%e5%87%86%e5%85%a5%e6%96%b9%e9%9d%a2 aria-label=节点准入方面>节点准入方面</a></li><li><a href=#%e8%8a%82%e7%82%b9%e8%a7%92%e8%89%b2 aria-label=节点角色>节点角色</a></li><li><a href=#%e8%8a%82%e7%82%b9%e6%95%b0%e9%87%8f aria-label=节点数量>节点数量</a></li><li><a href=#%e8%8a%82%e7%82%b9%e5%8f%af%e4%bf%a1 aria-label=节点可信>节点可信</a></li><li><a href=#%e8%8a%82%e7%82%b9%e9%85%8d%e7%bd%ae aria-label=节点配置>节点配置</a></li><li><a href=#%e8%8a%82%e7%82%b9%e7%bb%8f%e6%b5%8e%e5%8e%9f%e5%88%99 aria-label=节点经济原则>节点经济原则</a></li></ul></li><li><a href=#%e5%85%b1%e8%af%86%e7%ae%97%e6%b3%95 aria-label=共识算法>共识算法</a><ul><li><a href=#%e5%b1%9e%e6%80%a7 aria-label=属性>属性</a><ul><li><a href=#agreement aria-label=Agreement>Agreement</a></li><li><a href=#validity aria-label=Validity>Validity</a></li><li><a href=#integrity aria-label=Integrity>Integrity</a></li><li><a href=#termination aria-label=Termination>Termination</a></li></ul></li></ul></li><li><a href=#%e4%b8%9a%e5%8a%a1 aria-label=业务>业务</a></li><li><a href=#%e5%ae%b9%e9%94%99%e8%a6%81%e6%b1%82 aria-label=容错要求>容错要求</a><ul><li><a href=#dcs%e5%ae%9a%e7%90%86 aria-label=DCS定理>DCS定理</a><ul><li><a href=#%e5%8e%bb%e4%b8%ad%e5%bf%83%e5%8c%96 aria-label=去中心化>去中心化</a></li><li><a href=#%e4%b8%80%e8%87%b4%e6%80%a7 aria-label=一致性>一致性</a></li><li><a href=#%e5%8f%af%e6%89%a9%e5%b1%95%e6%80%a7 aria-label=可扩展性>可扩展性</a></li></ul></li></ul></li></ul></li><li><a href=#%e5%b0%8f%e7%bb%93 aria-label=小结>小结</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><h1 id=说明>说明<a hidden class=anchor aria-hidden=true href=#说明>#</a></h1><p>前面写一篇关于分布式系统的文章，但是没有考虑拜占庭问题，所以聊聊区块链共识技术，在这个过程看看比特币是如何解决拜占庭问题和共识问题。</p><h1 id=定义>定义<a hidden class=anchor aria-hidden=true href=#定义>#</a></h1><p>区块链是什么？这个问题有太多的回答。</p><blockquote><p>区块链是一个由全体联网节点共同维护并持有同一账本的分布式数据库，它通过算法来达成共识，在无需信任的各节点中构建一个无单一故障点或控制点的去中心化可信系统</p></blockquote><p>所以在技术上区块链的本质是分布式帐本技术(DLT)。</p><h1 id=重要性>重要性<a hidden class=anchor aria-hidden=true href=#重要性>#</a></h1><p><a href=https://medium.com/s/story/why-decentralization-matters-5e3f79f7638e>Why Decentralization Matters</a>这篇文章从互联网发展历程与面临问题说明去中心化重要性。</p><p>去中心化重要性来自去中心化带来的影响与作用，具体如下：</p><ol><li>去中心化可以降低垄断的可能性，是一种对抗垄断的重要方式</li><li>去中心化提供高可用性</li><li>去中心化对抗DDos</li><li>去中心化可以让人人参与，权力下放</li><li>去中心化是让数据归还用户，保护隐私的重要技术手段之一</li><li>去中心化消除中间环节，提高效率</li><li>去中心化与中心化并不是对立，可以相互补充</li><li>去中心化能够解决中心化无法解决的问题，如微信流控算法，并没有采用全局，而由节点根据延迟参数调整，另外是5G带来的高速传输与海量数据需要去中心化来来解决</li></ol><h1 id=去中心化解决问题>去中心化解决问题<a hidden class=anchor aria-hidden=true href=#去中心化解决问题>#</a></h1><ol><li>提供全球开放的分布式数据</li><li>提供不可更改的数据库</li><li>提供trustless的基础设施</li><li>基于以上三点的业务的需求</li></ol><h1 id=思考模型>思考模型<a hidden class=anchor aria-hidden=true href=#思考模型>#</a></h1><p>如同前面的分布式系统一样，对于公链（去中心化系统）问题，也可以分为以下几个子问题：</p><ol><li>在什么环境下？</li><li>有哪些节点参与？</li><li>通过什么样的共识算法？</li><li>使什么业务？</li><li>达成什么样的容错要求？</li></ol><p>总结一句话：<strong>在什么环境下，有哪些节点参与，通过什么样的共识算法，使什么业务达成什么样的容错要求</strong>。</p><p>下面就这五个问题展开说明。</p><h2 id=环境>环境<a hidden class=anchor aria-hidden=true href=#环境>#</a></h2><p>大部分去中心化系统的环境要点如下：</p><ol><li>异步网络模型</li><li>网络结构是P2P网络</li><li>网络传输是不可靠的</li><li>系统异常是常态</li><li>并发</li><li>缺少全局时钟</li></ol><p>(Ps:这里不展开说明了，<a href=https://blog.ipds.top/2018/12/11/%E8%B0%88%E8%B0%88%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/>谈谈对分布式系统的一些思考</a>)</p><h2 id=节点>节点<a hidden class=anchor aria-hidden=true href=#节点>#</a></h2><h3 id=节点准入方面>节点准入方面<a hidden class=anchor aria-hidden=true href=#节点准入方面>#</a></h3><ol><li>节点自由加入与退出</li><li>节点需要通过PoW测试才能加入</li><li>节点需要PoS持仓才能加入</li><li>节点需要质押才能加入</li></ol><h3 id=节点角色>节点角色<a hidden class=anchor aria-hidden=true href=#节点角色>#</a></h3><ol><li>节点平等，无角色任何差异如比特币</li><li>节点分为超级节点，见证节点如EOS</li></ol><h3 id=节点数量>节点数量<a hidden class=anchor aria-hidden=true href=#节点数量>#</a></h3><ol><li>不限数量，如比特币，以太坊</li><li>指定数量，如EOS指定为21，steemit指定数量为11</li></ol><h3 id=节点可信>节点可信<a hidden class=anchor aria-hidden=true href=#节点可信>#</a></h3><ol><li>存在不可信的作恶节点</li><li>可信节点（算力）一定多于作恶节点（算力）</li></ol><h3 id=节点配置>节点配置<a hidden class=anchor aria-hidden=true href=#节点配置>#</a></h3><ol><li>机器性能波动大</li><li>网络带宽波动大</li><li>节点分布在全球各地</li><li>节点配置不受控</li><li>节点之间差异大如算力，POS投票权重</li></ol><h3 id=节点经济原则>节点经济原则<a hidden class=anchor aria-hidden=true href=#节点经济原则>#</a></h3><ol><li>99.99%以上节点是趋利</li><li>节点受激励引导</li><li>节点受惩罚限制</li><li>节点之间存在博弈与竞争</li><li>节点不会作出投入成本大于产出收益的选择</li></ol><h2 id=共识算法>共识算法<a hidden class=anchor aria-hidden=true href=#共识算法>#</a></h2><p>一定要摆脱传统分布式思想的限制。要在经济，竞争，博弈，协议等多方面有效结合。</p><p><img loading=lazy src=/images/blockchain/blockchain-consensus-overview.jpeg alt=共识></p><p>从上图可以看出，传统分布式共识算法在整个共识里面只占很小一部分。
共识算法是区块链技术上的核心。</p><p>不得不说，PoW是另一种形式实现拜占庭容错，是比特币最大的亮点。</p><h3 id=属性>属性<a hidden class=anchor aria-hidden=true href=#属性>#</a></h3><p>一个科学共识算法必须同时满足以下四个属性：</p><ol><li>Agreement</li><li>Validity</li><li>Integrity</li><li>Termination</li></ol><p>这四个属性从四个方面规范共识算法的要求，也为我们提供分析共识算法四个不同的视角。</p><h4 id=agreement>Agreement<a hidden class=anchor aria-hidden=true href=#agreement>#</a></h4><blockquote><p>Every correct process must agree on the same value.</p></blockquote><p>这是实现一致性必须要做到的要求：每个节点必须达成一致。
bitcoin通过以下几点实现该属性，具体如下：</p><ol><li>在选主方面选择最强算力原则，保证具体高度的区块的一致性（以最快算出的为准）</li><li>在链分叉情况下选择最长链，解决网络分化等原因可能出现的分叉问题</li></ol><h4 id=validity>Validity<a hidden class=anchor aria-hidden=true href=#validity>#</a></h4><blockquote><p>If all the correct processes proposed the same value v, then any correct process must decide v.</p></blockquote><p>Validity是为了防止这种情况的出现：一些节点无论提议什么值，本节点一直提交NULL。在bitcoin这种行为可以理解为自私挖矿行为。</p><p>bitcoin通过以下几点实现该属性，具体如下：</p><ol><li>算力不可复制</li><li>随机性加大自私挖矿的成本</li><li>最长链确认由各节点自行确认</li><li>时间戳确认</li></ol><h4 id=integrity>Integrity<a hidden class=anchor aria-hidden=true href=#integrity>#</a></h4><blockquote><p>No Node decides twice.</p></blockquote><p>保证共识得到一致性不可逆，不可被修改。那么在这成共识过程中有许多操作需要进行限制。
bitcoin通过以下几点实现该属性，具体如下：</p><ol><li>链式结构</li><li>算力要求</li><li>难度提升</li><li>多节点竞争</li></ol><h4 id=termination>Termination<a hidden class=anchor aria-hidden=true href=#termination>#</a></h4><blockquote><p>Eventually, every correct process decides some value.</p></blockquote><p>Termination是一个liveness属性，bitcoin通过以下几点实现该属性，具体如下：</p><ol><li>通过激励吸引大量节点参与，保证有节点来完成出块</li><li>出块时间周期设置10分钟</li></ol><h2 id=业务>业务<a hidden class=anchor aria-hidden=true href=#业务>#</a></h2><p>去中心化带来业务的形态的变化，现列举部分业务如下：</p><ol><li>去中心化交易所</li><li>去中心化网络平台</li><li>去中心化计算平台</li><li>去中心化存储</li><li>去中心化CDN</li><li>去中心化数字货币</li><li>去中心化协议</li><li>去中心化跨链</li><li>去中心化金融科技DeFi</li><li>去中心化通信</li></ol><h2 id=容错要求>容错要求<a hidden class=anchor aria-hidden=true href=#容错要求>#</a></h2><p>对于去中心化系统，对应的容错要求是DCS定理。</p><h3 id=dcs定理>DCS定理<a hidden class=anchor aria-hidden=true href=#dcs定理>#</a></h3><p>如同CAP定理一样，DCS定理是指在一个公有链系统中不可能同时满足以下三个条件：去中心化（Decentralized）、一致性（Consistency）和可扩展性（Scale）。</p><p><img loading=lazy src=/images/DCS.png alt=DCS定理></p><h4 id=去中心化>去中心化<a hidden class=anchor aria-hidden=true href=#去中心化>#</a></h4><p>去中心化是指任意节点可以加入与退出，整个网络不受任何人控制。</p><h4 id=一致性>一致性<a hidden class=anchor aria-hidden=true href=#一致性>#</a></h4><p>与上面CAP的一致性类似，不过应用中更加偏重安全如防范双花攻击。</p><h4 id=可扩展性>可扩展性<a hidden class=anchor aria-hidden=true href=#可扩展性>#</a></h4><p>可扩展性是指TPS能够实现提高。</p><p>关于DCS这三者之间的tradeoff，更多参考<a href=https://blog.bigchaindb.com/the-dcs-triangle-5ce0e9e0f1dc>The DCS Triangle</a></p><h1 id=小结>小结<a hidden class=anchor aria-hidden=true href=#小结>#</a></h1><p>区块链的共识现在还处于探索阶段，并不像分布式系统共识（不考虑拜占庭问题）已经成熟。区块链的共识在不断探索与发展中，未来会有更多的新型共识出来。</p><h1 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h1><ol><li><a href=https://medium.com/s/story/why-decentralization-matters-5e3f79f7638e>Why Decentralization Matters</a></li><li><a href=https://blog.bigchaindb.com/the-dcs-triangle-5ce0e9e0f1dc>The DCS Triangle</a></li><li><a href=https://blog.acolyer.org/2018/02/12/sok-consensus-in-the-age-of-blockchains/>SoK: Consensus in the age of blockchains</a></li><li><a href=https://mp.weixin.qq.com/s/t9M56GGwDGtoj-yufSw9Tg>DAGOR：微信微服务过载控制系统</a></li><li><a href=https://www.the-paper-trail.org/post/2008-08-13-a-brief-tour-of-flp-impossibility/>A Brief Tour of FLP Impossibility</a></li><li><a href=https://eprint.iacr.org/2018/400.pdf>Agreement with Satoshi – On the Formalization of Nakamoto Consensus</a></li><li><a href="https://www.ted.com/talks/yuval_noah_harari_why_fascism_is_so_tempting_and_how_your_data_could_power_it?language=en#t-309440">Yuval Noah Harari: Why fascism is so tempting and how your data could power it | TED Talk</a></li><li><a href=https://medium.com/the-new-york-times/tech-c-e-o-s-are-in-love-with-their-principal-doomsayer-2500f8a63fc7>Tech C.E.O.s Are in Love With Their Principal Doomsayer</a></li><li><a href=https://blog.ipds.top/2018/12/11/%E8%B0%88%E8%B0%88%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/>谈谈对分布式系统的一些思考</a></li><li><a href=https://medium.com/algorand/algorands-instant-consensus-protocol-e66ac5807e37>Algorand’s Instant Consensus Protocol</a></li><li><a href=https://mp.weixin.qq.com/s/p-vWDOJEWLk5KKal4CJgJA>区块链到底有什么了不起</a></li><li><a href=https://en.wikipedia.org/wiki/BitTorrent>BitTorrent</a></li><li><a href=https://mp.weixin.qq.com/s/MWGM3Nci20_4sXMe7fpcsA>公有链的基本挑战</a></li><li><a href=https://hackernoon.com/blockchains-dont-scale-not-today-at-least-but-there-s-hope-2cb43946551a>Blockchains don’t scale. Not today, at least. But there’s hope.</a></li><li><a href=https://medium.com/@wahabjawed/consensus-protocol-of-distributed-ledger-technology-c61526490e60>Consensus Protocols of Distributed Ledger Technology</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://myself659.github.io/tags/distributed/>Distributed</a></li><li><a href=https://myself659.github.io/tags/blockchain/>blockchain</a></li></ul><nav class=paginav><a class=prev href=https://myself659.github.io/post/cache-101/><span class=title>« 上一页</span><br><span>Cache 101</span></a>
<a class=next href=https://myself659.github.io/post/distributed-theory/><span class=title>下一页 »</span><br><span>谈谈对分布式系统的一些思考</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on twitter" href="https://twitter.com/intent/tweet/?text=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f&amp;hashtags=Distributed%2cBlockChain"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f&amp;title=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83&amp;summary=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83&amp;source=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f&title=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83%20-%20https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 关于区块链共识的一些思考 on telegram" href="https://telegram.me/share/url?text=%e5%85%b3%e4%ba%8e%e5%8c%ba%e5%9d%97%e9%93%be%e5%85%b1%e8%af%86%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%9d%e8%80%83&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2fblockchain%2f%25E5%2585%25B3%25E4%25BA%258E%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE%25E5%2585%25B1%25E8%25AF%2586%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%2580%259D%25E8%2580%2583%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://myself659.github.io/>沉风网事</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>