<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux x86-64 函数调用栈实例分析 | 沉风网事</title><meta name=keywords content="Linux"><meta name=description content="前言 动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈"><meta name=author content="沉风"><link rel=canonical href=https://myself659.github.io/post/2016-03-09-x86-64-call-stack/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://myself659.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://myself659.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://myself659.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://myself659.github.io/apple-touch-icon.png><link rel=mask-icon href=https://myself659.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-144475213-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Linux x86-64 函数调用栈实例分析"><meta property="og:description" content="前言 动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈"><meta property="og:type" content="article"><meta property="og:url" content="https://myself659.github.io/post/2016-03-09-x86-64-call-stack/"><meta property="og:image" content="https://myself659.github.io/"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-03-09T11:58:06+02:00"><meta property="article:modified_time" content="2016-03-09T11:58:06+02:00"><meta property="og:site_name" content="沉风网事"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://myself659.github.io/"><meta name=twitter:title content="Linux x86-64 函数调用栈实例分析"><meta name=twitter:description content="前言 动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://myself659.github.io/post/"},{"@type":"ListItem","position":2,"name":"Linux x86-64 函数调用栈实例分析","item":"https://myself659.github.io/post/2016-03-09-x86-64-call-stack/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux x86-64 函数调用栈实例分析","name":"Linux x86-64 函数调用栈实例分析","description":"前言 动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈","keywords":["Linux"],"articleBody":"前言 动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈值)。本文目的希望通过分析一个简单的函数调用加深对x86-64寄存器及栈帧的结构的认识，以便在定位问题需要的时候能够熟练运用。\n环境 1.操作系统和内核\n1 2 [root@localhost ~]# cat /proc/version Linux version 3.10.0-229.4.2.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.2 20140120 (Red Hat 4.8.2-16) (GCC) ) #1 SMP Wed May 13 10:06:09 UTC 2015 2.GCC版本\n1 2 3 4 5 6 7 8 [root@localhost ~]# gcc -v Using built-in specs. COLLECT_GCC=gcc COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.3/lto-wrapper Target: x86_64-redhat-linux Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux Thread model: posix gcc version 4.8.3 20140911 (Red Hat 4.8.3-9) (GCC) 3.GDB版本\n1 2 3 4 5 6 7 8 9 10 [root@localhost ~]# gdb --version GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7 Copyright (C) 2013 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type \"show copying\" and \"show warranty\" for details. This GDB was configured as \"x86_64-redhat-linux-gnu\". For bug reporting instructions, please see: . GDB 分析调用栈 1. 准备代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #include int sum(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9) { int s = 0xaaaa; s = a1+a2+a3+a4+a5+a6+a7+a8+a9; return s; } void caller(void) { int iRet = 0x0; iRet = sum(0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99); printf(\"sum: %x\\r\\n\", iRet); } int main(void) { caller(); return 0; } 2. 生成可执行文件 1 2 3 [root@localhost cpp]# gcc -g stackexample.c -o stackexample [root@localhost cpp]# ./stackexample sum: 2FD 3. 分析调用栈 主要通过gdb分析调用栈变化情况\n3.1 初始化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 Breakpoint 1, main () at stackexample.c:22 warning: Source file is more recent than executable. 22 caller(); Missing separate debuginfos, use: debuginfo-install glibc-2.17-78.el7.x86_64 (gdb) info registers rax 0x4005e6 4195814 rbx 0x0 0 rcx 0x400600 4195840 rdx 0x7fffffffe518 140737488348440 rsi 0x7fffffffe508 140737488348424 rdi 0x1 1 rbp 0x7fffffffe420 0x7fffffffe420 rsp 0x7fffffffe420 0x7fffffffe420 r8 0x7ffff7dd5e80 140737351868032 r9 0x0 0 r10 0x7fffffffe270 140737488347760 r11 0x7ffff7a3ba00 140737348090368 r12 0x400440 4195392 r13 0x7fffffffe500 140737488348416 r14 0x0 0 r15 0x0 0 rip 0x4005ea 0x4005ea eflags 0x246 [ PF ZF IF ] cs 0x33 51 ss 0x2b 43 ds 0x0 0 es 0x0 0 fs 0x0 0 ---Type to continue, or q to quit--- gs 0x0 0 (gdb) 栈内存（堆栈向下生长）:\n1 2 3 4 5 6 7 8 9 10 11 12 rbp 0x7fffffffe420 0x7fffffffe420 rsp 0x7fffffffe420 0x7fffffffe420 0x7fffffffe428 +------------------+ | | rbp-\u003e0x7fffffffe420 +------------------+ \u003c-rsp | | 0x7fffffffe218 +------------------+ | | 0x7fffffffe210 +------------------+ | | 0x7fffffffe208 +------------------+ 3.2 调用caller 寄存器信息：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 (gdb) s caller () at stackexample.c:14 14 int iRet = 0x0; (gdb) info registers rax 0x4005e6 4195814 rbx 0x0 0 rcx 0x400600 4195840 rdx 0x7fffffffe518 140737488348440 rsi 0x7fffffffe508 140737488348424 rdi 0x1 1 rbp 0x7fffffffe410 0x7fffffffe410 rsp 0x7fffffffe3e0 0x7fffffffe3e0 r8 0x7ffff7dd5e80 140737351868032 r9 0x0 0 r10 0x7fffffffe270 140737488347760 r11 0x7ffff7a3ba00 140737348090368 r12 0x400440 4195392 r13 0x7fffffffe500 140737488348416 r14 0x0 0 r15 0x0 0 rip 0x40058a 0x40058a eflags 0x202 [ IF ] cs 0x33 51 ss 0x2b 43 ds 0x0 0 es 0x0 0 fs 0x0 0 ---Type to continue, or q to quit--- gs 0x0 0 (gdb) x /6gx 0x7fffffffe3e0 0x7fffffffe3e0: 0x0000000000000001 0x000000000040064d 0x7fffffffe3f0: 0x0000000000000000 0x0000000000000000 0x7fffffffe400: 0x0000000000400600 0x0000000000400440 (gdb) (gdb) x /12gx 0x7fffffffe3e0 0x7fffffffe3e0: 0x0000000000000001 0x000000000040064d 0x7fffffffe3f0: 0x0000000000000000 0x0000000000000000 0x7fffffffe400: 0x0000000000400600 0x0000000000400440 #小端系统，前8位存储iRet的值 0x7fffffffe410: 0x00007fffffffe420 0x00000000004005ef 0x7fffffffe420: 0x0000000000000000 0x00007ffff7a3baf5 0x7fffffffe430: 0x0000002000000000 0x00007fffffffe508 (gdb) (gdb) p iRet $3 = 0 (gdb) p \u0026iRet $4 = (int *) 0x7fffffffe40c #局部变量在堆栈的位置 栈内存（堆栈向下生长）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 rbp 0x7fffffffe410 0x7fffffffe410 rsp 0x7fffffffe3e0 0x7fffffffe3e0 0x7fffffffe428 +------------------+ | | 0x7fffffffe420 +------------------+ |0x00000000004005ef| #保存返回main的指令地址,参考汇编代码 0x7fffffffe418 +------------------+ |0x00007fffffffe420| #保存main函数对应rbp rbp --\u003e0x7fffffffe410 +------------------+ | | 0x7fffffffe408 +------------------+ | | 0x7fffffffe400 +------------------+ | | 0x7fffffffe3f8 +------------------+ | | 0x7fffffffe3f0 +------------------+ | | 0x7fffffffe3e8 +------------------+ | | rsp --\u003e0x7fffffffe3e0 +------------------+ main函数的汇编代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 (gdb) disassemble /m main Dump of assembler code for function main: 21 { 0x00000000004005e6 \u003c+0\u003e: push %rbp 0x00000000004005e7 \u003c+1\u003e: mov %rsp,%rbp 22 caller(); 0x00000000004005ea \u003c+4\u003e: callq 0x400582 23 24 return 0; 0x00000000004005ef \u003c+9\u003e: mov $0x0,%eax #调用caller返回后执行的指令地址 25 } 0x00000000004005f4 \u003c+14\u003e: pop %rbp 0x00000000004005f5 \u003c+15\u003e: retq End of assembler dump. (gdb) 3.3调用sum 寄存器信息：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 Breakpoint 2, sum (a1=17, a2=34, a3=51, a4=68, a5=85, a6=102, a7=119, a8=136, a9=153) at stackexample.c:6 6 int s = 0x0; (gdb) info registers rax 0x4005e6 4195814 rbx 0x0 0 rcx 0x44 68 #第四个参数 rdx 0x33 51 #第三个参数 rsi 0x22 34 #第二个参数 rdi 0x11 17 #第一个参数 rbp 0x7fffffffe3d0 0x7fffffffe3d0 rsp 0x7fffffffe3d0 0x7fffffffe3d0 r8 0x55 85 #第五个参数 r9 0x66 102 #第六个参数 r10 0x7fffffffe270 140737488347760 r11 0x7ffff7a3ba00 140737348090368 r12 0x400440 4195392 r13 0x7fffffffe500 140737488348416 r14 0x0 0 r15 0x0 0 rip 0x400548 0x400548 eflags 0x202 [ IF ] cs 0x33 51 ss 0x2b 43 ds 0x0 0 es 0x0 0 fs 0x0 0 ---Type to continue, or q to quit--- gs 0x0 0 (gdb) caller对应汇编代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 (gdb) disassemble /m caller Dump of assembler code for function caller: 13 { 0x0000000000400582 \u003c+0\u003e: push %rbp #保存调用函数main的rbp 0x0000000000400583 \u003c+1\u003e: mov %rsp,%rbp #将上一个栈顶指针作为本函数的栈底（设置当前函数的栈基址） 0x0000000000400586 \u003c+4\u003e: sub $0x30,%rsp #分配栈空间 14 int iRet = 0x0; 0x000000000040058a \u003c+8\u003e: movl $0x0,-0x4(%rbp) 15 16 iRet = sum(0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99); 0x0000000000400591 \u003c+15\u003e: movl $0x99,0x10(%rsp) #第9个参数 0x0000000000400599 \u003c+23\u003e: movl $0x88,0x8(%rsp) #第8个参考 0x00000000004005a1 \u003c+31\u003e: movl $0x77,(%rsp) #第7个参数 0x00000000004005a8 \u003c+38\u003e: mov $0x66,%r9d #第6个参数 0x00000000004005ae \u003c+44\u003e: mov $0x55,%r8d #第5个参数 0x00000000004005b4 \u003c+50\u003e: mov $0x44,%ecx #第4个参数 0x00000000004005b9 \u003c+55\u003e: mov $0x33,%edx #第3个参数 0x00000000004005be \u003c+60\u003e: mov $0x22,%esi #第2个参数 0x00000000004005c3 \u003c+65\u003e: mov $0x11,%edi #第1个参数 0x00000000004005c8 \u003c+70\u003e: callq 0x400530 #调用函数sum 0x00000000004005cd \u003c+75\u003e: mov %eax,-0x4(%rbp) #取返回值 ---Type to continue, or q to quit--- 17 printf(\"sum: %X\\r\\n\", iRet); 0x00000000004005d0 \u003c+78\u003e: mov -0x4(%rbp),%eax 0x00000000004005d3 \u003c+81\u003e: mov %eax,%esi 0x00000000004005d5 \u003c+83\u003e: mov $0x400690,%edi 0x00000000004005da \u003c+88\u003e: mov $0x0,%eax 0x00000000004005df \u003c+93\u003e: callq 0x400410 18 } 0x00000000004005e4 \u003c+98\u003e: leaveq #出栈处理 0x00000000004005e5 \u003c+99\u003e: retq End of assembler dump. (gdb) 通过上面汇编与寄存器信息，可以了解到函数调用的参数一般先通过寄存器传递。但是可用于传递函数的参数有限，超出的参数怎么传递呢？入调用函数的栈空间，具体如下：\n1 2 3 4 5 6 7 8 (gdb) x /12gx $rsp 0x7fffffffe3d0: 0x00007fffffffe410 0x00000000004005cd #main函数栈底，返回指令 0x7fffffffe3e0: 0x0000000000000077 0x0000000000000088 #第七个参数 第八个参数 0x7fffffffe3f0: 0x0000000000000099 0x0000000000000000 #第九个参数 0x7fffffffe400: 0x0000000000400600 0x0000000000400440 #这两个内容是什么 0x7fffffffe410: 0x00007fffffffe420 0x00000000004005ef 0x7fffffffe420: 0x0000000000000000 0x00007ffff7a3baf5 (gdb) 栈内存（栈向下生长）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 rbp 0x7fffffffe3d0 0x7fffffffe3d0 rsp 0x7fffffffe3d0 0x7fffffffe3d0 0x7fffffffe428 +------------------+ | | 0x7fffffffe420 +------------------+ |0x00000000004005ef| #保存返回main的地址 0x7fffffffe418 +------------------+ |0x00007fffffffe420| #保存main函数对应rbp 0x7fffffffe410 +------------------+ | | 0x7fffffffe408 +------------------+ | | 0x7fffffffe400 +------------------+ | | 0x7fffffffe3f8 +------------------+ | 0x99 | 0x7fffffffe3f0 +------------------+ | 0x88 | 0x7fffffffe3e8 +------------------+ | 0x77 | 0x7fffffffe3e0 +------------------+ |0x00000000004005cd| #保存调用caller返回的指令地址 0x7fffffffe3e0 +------------------+ |0x00007fffffffe410| #保存caller函数对应的rbp rsp --\u003e0x7fffffffe3e0 +------------------+ 3.4 sum获取参数 1 2 3 4 5 6 7 8 9 (gdb) x /16gx $rsp-0x28 0x7fffffffe3a8: 0x0000005500000066 0x0000003300000044 0x7fffffffe3b8: 0x0000001100000022 0x0000000000000006 0x7fffffffe3c8: 0x00000000f7ab9646 0x00007fffffffe410 0x7fffffffe3d8: 0x00000000004005cd 0x0000000000000077 0x7fffffffe3e8: 0x0000000000000088 0x0000000000000099 0x7fffffffe3f8: 0x0000000000000000 0x0000000000400600 0x7fffffffe408: 0x0000000000400440 0x00007fffffffe420 0x7fffffffe418: 0x00000000004005ef 0x0000000000000000 栈内存（栈向下生长）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 rbp 0x7fffffffe3e0 0x7fffffffe3e0 rsp 0x7fffffffe3e0 0x7fffffffe3e0 0x7fffffffe428 +------------------+ | | 0x7fffffffe420 +------------------+ |0x00000000004005ef| #保存返回main的地址 0x7fffffffe418 +------------------+ |0x00007fffffffe420| #保存main函数对应rbp 0x7fffffffe410 +------------------+ | | 0x7fffffffe408 +------------------+ | | 0x7fffffffe400 +------------------+ | | 0x7fffffffe3f8 +------------------+ | 0x99 | 0x7fffffffe3f0 +------------------+ | 0x88 | 0x7fffffffe3e8 +------------------+ | 0x77 | 0x7fffffffe3e0 +------------------+ |0x00000000004005cd| #保存返回caller的指令地址 0x7fffffffe3e0 +------------------+ |0x00007fffffffe410| #保存caller函数对应的rbp rsp --\u003e0x7fffffffe3e0 +------------------+ | | 0x7fffffffe3d8 +------------------+ | | 0x7fffffffe3d0 +------------------+ | | 0x7fffffffe3e8 +------------------+ | | 0x7fffffffe3e0 +------------------+ | | 0x7fffffffe3c8 +------------------+ | | 0x7fffffffe3c0 +------------------+ |0x0000001100000022| 0x7fffffffe3b8 +------------------+ |0x0000005500000066| 0x7fffffffe3b0 +------------------+ |0x0000003300000044| 0x7fffffffe3a8 +------------------+ | | 0x7fffffffe3a0 +------------------+ sum函数对应汇编如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 (gdb) disassemble /m sum Dump of assembler code for function sum: 5 { 0x0000000000400530 \u003c+0\u003e: push %rbp 0x0000000000400531 \u003c+1\u003e: mov %rsp,%rbp 0x0000000000400534 \u003c+4\u003e: mov %edi,-0x14(%rbp) #获取函数参数，顺序为从左到右 0x0000000000400537 \u003c+7\u003e: mov %esi,-0x18(%rbp) 0x000000000040053a \u003c+10\u003e: mov %edx,-0x1c(%rbp) 0x000000000040053d \u003c+13\u003e: mov %ecx,-0x20(%rbp) 0x0000000000400540 \u003c+16\u003e: mov %r8d,-0x24(%rbp) 0x0000000000400544 \u003c+20\u003e: mov %r9d,-0x28(%rbp) 6 int s = 0x0; 0x0000000000400548 \u003c+24\u003e: movl $0x0,-0x4(%rbp) 7 s = a1+a2+a3+a4+a5+a6+a7+a8+a9; =\u003e 0x000000000040054f \u003c+31\u003e: mov -0x18(%rbp),%eax 0x0000000000400552 \u003c+34\u003e: mov -0x14(%rbp),%edx 0x0000000000400555 \u003c+37\u003e: add %eax,%edx 0x0000000000400557 \u003c+39\u003e: mov -0x1c(%rbp),%eax 0x000000000040055a \u003c+42\u003e: add %eax,%edx 0x000000000040055c \u003c+44\u003e: mov -0x20(%rbp),%eax 0x000000000040055f \u003c+47\u003e: add %eax,%edx 0x0000000000400561 \u003c+49\u003e: mov -0x24(%rbp),%eax ---Type to continue, or q to quit--- 0x0000000000400564 \u003c+52\u003e: add %eax,%edx 0x0000000000400566 \u003c+54\u003e: mov -0x28(%rbp),%eax 0x0000000000400569 \u003c+57\u003e: add %eax,%edx 0x000000000040056b \u003c+59\u003e: mov 0x10(%rbp),%eax #取参数a7 = 0x77 0x000000000040056e \u003c+62\u003e: add %eax,%edx 0x0000000000400570 \u003c+64\u003e: mov 0x18(%rbp),%eax #取参数a8 = 0x88 0x0000000000400573 \u003c+67\u003e: add %eax,%edx 0x0000000000400575 \u003c+69\u003e: mov 0x20(%rbp),%eax #取参数a9 = 0x99 0x0000000000400578 \u003c+72\u003e: add %edx,%eax 0x000000000040057a \u003c+74\u003e: mov %eax,-0x4(%rbp) 8 9 return s; 0x000000000040057d \u003c+77\u003e: mov -0x4(%rbp),%eax #计算结果通过eax寄存器返回 10 } 0x0000000000400580 \u003c+80\u003e: pop %rbp 0x0000000000400581 \u003c+81\u003e: retq End of assembler dump. (gdb) 注意的是调用sum的时候并没有分配栈空间？主要原因是sum函数内没有调用其他函数，sum就只能被别的函数调用，sum的局部变量直接由rsp向下生长，调用结束后，直接恢复调用者的栈，这样的好处有两个：\n少一个指令，提高执行效率 编译的时候并不需要计算需要开辟多少栈空间 为什么需要将值从寄存器取出？直接利用寄存器取值不可以吗？ 传递参数的寄存器在函数执行指令的时候有其他用处，调用函数需要将参数从寄存器取出到栈内存中（在一定的情况下即调用函数的指令不需要占用传递参数的寄存器，如果加大编译的优化级别，是否不会从参数寄存器取出参数到函数的栈内存中而是直接使用寄存器？）另外可以从这里看出，从代码层面优化性能可以考虑减少函数调用以及优化一些不必要的参数传递，尽管只能尽一丝绵薄之力。\n3.5 sum返回值 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 (gdb) n caller () at stackexample.c:17 17 printf(\"sum: %X\\r\\n\", iRet); (gdb) info registers rax 0x2fd 765 #返回值 rbx 0x0 0 rcx 0x44 68 rdx 0x264 612 rsi 0x22 34 rdi 0x11 17 rbp 0x7fffffffe410 0x7fffffffe410 rsp 0x7fffffffe3e0 0x7fffffffe3e0 r8 0x55 85 r9 0x66 102 r10 0x7fffffffe270 140737488347760 r11 0x7ffff7a3ba00 140737348090368 r12 0x400440 4195392 r13 0x7fffffffe500 140737488348416 r14 0x0 0 r15 0x0 0 rip 0x4005d0 0x4005d0 eflags 0x202 [ IF ] cs 0x33 51 ss 0x2b 43 ds 0x0 0 es 0x0 0 fs 0x0 0 ---Type to continue, or q to quit--- gs 0x0 0 (gdb) (gdb) x /16gx 0x7fffffffe3c0 0x7fffffffe3c0: 0x0000000000000006 0x000002fdf7ab9646 #返回值0x2fd 0x7fffffffe3d0: 0x00007fffffffe410 0x00000000004005cd 0x7fffffffe3e0: 0x0000000000000077 0x0000000000000088 0x7fffffffe3f0: 0x0000000000000099 0x0000000000000000 0x7fffffffe400: 0x0000000000400600 0x000002fd00400440 0x7fffffffe410: 0x00007fffffffe420 0x00000000004005ef 0x7fffffffe420: 0x0000000000000000 0x00007ffff7a3baf5 0x7fffffffe430: 0x0000002000000000 0x00007fffffffe508 (gdb) x86-64寄存器说明 rsp：对应32位esp寄存器，保存当前堆栈栈顶指针的寄存器 rbp：对应32位ebp寄存器，保存了当前堆栈基地址指针的寄存器 rax: 临时寄存器，当我们调用系统调用的时候，rax保外系统调用号 rdx：传递第3个参数到函数 rdi：传递第1个参数到函数 rsi：传递第2个参数到函数 rip: 下一个执行指令地址 参考 Calling_convention GDB and Reverse Debugging Assembly x86_64 programming for Linux ","wordCount":"3124","inLanguage":"zh","datePublished":"2016-03-09T11:58:06+02:00","dateModified":"2016-03-09T11:58:06+02:00","author":{"@type":"Person","name":"沉风"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://myself659.github.io/post/2016-03-09-x86-64-call-stack/"},"publisher":{"@type":"Organization","name":"沉风网事","logo":{"@type":"ImageObject","url":"https://myself659.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://myself659.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://myself659.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://myself659.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://myself659.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://myself659.github.io/search/ title=Search><span>Search</span></a></li><li><a href=https://myself659.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://myself659.github.io/about/ title=About><span>About</span></a></li><li><a href=https://myself659.github.io/post/leetcode/ title=LeetCode><span>LeetCode</span></a></li><li><a href=https://myself659.github.io/post/read-post/ title=Reading><span>Reading</span></a></li><li><a href=https://myself659.github.io/post/share-post/ title=Share><span>Share</span></a></li><li><a href=https://myself659.github.io/post/slide-post/ title=Slide><span>Slide</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://myself659.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://myself659.github.io/post/>Posts</a></div><h1 class=post-title>Linux x86-64 函数调用栈实例分析</h1><div class=post-meta><span title='2016-03-09 11:58:06 +0200 +0200'>2016-03-09</span>&nbsp;·&nbsp;沉风</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e7%8e%af%e5%a2%83 aria-label=环境>环境</a></li><li><a href=#gdb-%e5%88%86%e6%9e%90%e8%b0%83%e7%94%a8%e6%a0%88 aria-label="GDB 分析调用栈">GDB 分析调用栈</a><ul><li><a href=#1-%e5%87%86%e5%a4%87%e4%bb%a3%e7%a0%81 aria-label="1. 准备代码">1. 准备代码</a></li><li><a href=#2-%e7%94%9f%e6%88%90%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6 aria-label="2. 生成可执行文件">2. 生成可执行文件</a></li><li><a href=#3-%e5%88%86%e6%9e%90%e8%b0%83%e7%94%a8%e6%a0%88 aria-label="3. 分析调用栈">3. 分析调用栈</a></li><li><a href=#31-%e5%88%9d%e5%a7%8b%e5%8c%96 aria-label="3.1 初始化">3.1 初始化</a></li><li><a href=#32-%e8%b0%83%e7%94%a8caller aria-label="3.2 调用caller">3.2 调用caller</a></li><li><a href=#33%e8%b0%83%e7%94%a8sum aria-label=3.3调用sum>3.3调用sum</a></li><li><a href=#34-sum%e8%8e%b7%e5%8f%96%e5%8f%82%e6%95%b0 aria-label="3.4 sum获取参数">3.4 sum获取参数</a></li><li><a href=#35-sum%e8%bf%94%e5%9b%9e%e5%80%bc aria-label="3.5 sum返回值">3.5 sum返回值</a></li></ul></li><li><a href=#x86-64%e5%af%84%e5%ad%98%e5%99%a8%e8%af%b4%e6%98%8e aria-label=x86-64寄存器说明>x86-64寄存器说明</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><h3 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h3><p>动手实践并写文章花5倍的时间一次性把事情做到90分，好过读别人文章只能做到60分，后面还需要花时间继续深入学习(做事情一定要做到有效的阈值)。本文目的希望通过分析一个简单的函数调用加深对x86-64寄存器及栈帧的结构的认识，以便在定位问题需要的时候能够熟练运用。</p><h3 id=环境>环境<a hidden class=anchor aria-hidden=true href=#环境>#</a></h3><p>1.操作系统和内核</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost ~]# cat /proc/version 
</span></span><span class=line><span class=cl>Linux version 3.10.0-229.4.2.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.2 20140120 (Red Hat 4.8.2-16) (GCC) ) #1 SMP Wed May 13 10:06:09 UTC 2015
</span></span></code></pre></td></tr></table></div></div><p>2.GCC版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost ~]# gcc  -v
</span></span><span class=line><span class=cl>Using built-in specs.
</span></span><span class=line><span class=cl>COLLECT_GCC=gcc
</span></span><span class=line><span class=cl>COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.3/lto-wrapper
</span></span><span class=line><span class=cl>Target: x86_64-redhat-linux
</span></span><span class=line><span class=cl>Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
</span></span><span class=line><span class=cl>Thread model: posix
</span></span><span class=line><span class=cl>gcc version 4.8.3 20140911 (Red Hat 4.8.3-9) (GCC) 
</span></span></code></pre></td></tr></table></div></div><p>3.GDB版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost ~]# gdb --version
</span></span><span class=line><span class=cl>GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7
</span></span><span class=line><span class=cl>Copyright (C) 2013 Free Software Foundation, Inc.
</span></span><span class=line><span class=cl>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span></span><span class=line><span class=cl>This is free software: you are free to change and redistribute it.
</span></span><span class=line><span class=cl>There is NO WARRANTY, to the extent permitted by law.  Type &#34;show copying&#34;
</span></span><span class=line><span class=cl>and &#34;show warranty&#34; for details.
</span></span><span class=line><span class=cl>This GDB was configured as &#34;x86_64-redhat-linux-gnu&#34;.
</span></span><span class=line><span class=cl>For bug reporting instructions, please see:
</span></span><span class=line><span class=cl>&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
</span></span></code></pre></td></tr></table></div></div><h3 id=gdb-分析调用栈>GDB 分析调用栈<a hidden class=anchor aria-hidden=true href=#gdb-分析调用栈>#</a></h3><h4 id=1-准备代码>1. 准备代码<a hidden class=anchor aria-hidden=true href=#1-准备代码>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>sum</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a3</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a4</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>a6</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a7</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a8</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>s</span> <span class=o>=</span> <span class=mh>0xaaaa</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>a1</span><span class=o>+</span><span class=n>a2</span><span class=o>+</span><span class=n>a3</span><span class=o>+</span><span class=n>a4</span><span class=o>+</span><span class=n>a5</span><span class=o>+</span><span class=n>a6</span><span class=o>+</span><span class=n>a7</span><span class=o>+</span><span class=n>a8</span><span class=o>+</span><span class=n>a9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span>  <span class=nf>caller</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>iRet</span> <span class=o>=</span> <span class=mh>0x0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iRet</span> <span class=o>=</span> <span class=nf>sum</span><span class=p>(</span><span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;sum: %x</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>iRet</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>caller</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-生成可执行文件>2. 生成可执行文件<a hidden class=anchor aria-hidden=true href=#2-生成可执行文件>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost cpp]# gcc  -g  stackexample.c  -o stackexample
</span></span><span class=line><span class=cl>[root@localhost cpp]# ./stackexample
</span></span><span class=line><span class=cl>sum: 2FD
</span></span></code></pre></td></tr></table></div></div><h4 id=3-分析调用栈>3. 分析调用栈<a hidden class=anchor aria-hidden=true href=#3-分析调用栈>#</a></h4><p>主要通过gdb分析调用栈变化情况</p><h4 id=31-初始化>3.1 初始化<a hidden class=anchor aria-hidden=true href=#31-初始化>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Breakpoint 1, main () at stackexample.c:22
</span></span><span class=line><span class=cl>warning: Source file is more recent than executable.
</span></span><span class=line><span class=cl>22              caller();
</span></span><span class=line><span class=cl>Missing separate debuginfos, use: debuginfo-install glibc-2.17-78.el7.x86_64
</span></span><span class=line><span class=cl>(gdb) info  registers 
</span></span><span class=line><span class=cl>rax            0x4005e6 4195814
</span></span><span class=line><span class=cl>rbx            0x0      0
</span></span><span class=line><span class=cl>rcx            0x400600 4195840
</span></span><span class=line><span class=cl>rdx            0x7fffffffe518   140737488348440
</span></span><span class=line><span class=cl>rsi            0x7fffffffe508   140737488348424
</span></span><span class=line><span class=cl>rdi            0x1      1
</span></span><span class=line><span class=cl>rbp            0x7fffffffe420   0x7fffffffe420
</span></span><span class=line><span class=cl>rsp            0x7fffffffe420   0x7fffffffe420
</span></span><span class=line><span class=cl>r8             0x7ffff7dd5e80   140737351868032
</span></span><span class=line><span class=cl>r9             0x0      0
</span></span><span class=line><span class=cl>r10            0x7fffffffe270   140737488347760
</span></span><span class=line><span class=cl>r11            0x7ffff7a3ba00   140737348090368
</span></span><span class=line><span class=cl>r12            0x400440 4195392
</span></span><span class=line><span class=cl>r13            0x7fffffffe500   140737488348416
</span></span><span class=line><span class=cl>r14            0x0      0
</span></span><span class=line><span class=cl>r15            0x0      0
</span></span><span class=line><span class=cl>rip            0x4005ea 0x4005ea &lt;main+4&gt;
</span></span><span class=line><span class=cl>eflags         0x246    [ PF ZF IF ]
</span></span><span class=line><span class=cl>cs             0x33     51
</span></span><span class=line><span class=cl>ss             0x2b     43
</span></span><span class=line><span class=cl>ds             0x0      0
</span></span><span class=line><span class=cl>es             0x0      0
</span></span><span class=line><span class=cl>fs             0x0      0
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit--- 
</span></span><span class=line><span class=cl>gs             0x0      0
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><p>栈内存（堆栈向下生长）:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>rbp            0x7fffffffe420   0x7fffffffe420
</span></span><span class=line><span class=cl>rsp            0x7fffffffe420   0x7fffffffe420
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>         0x7fffffffe428 +------------------+
</span></span><span class=line><span class=cl>                        |                  |
</span></span><span class=line><span class=cl>    rbp-&gt;0x7fffffffe420 +------------------+  &lt;-rsp
</span></span><span class=line><span class=cl>                        |                  |
</span></span><span class=line><span class=cl>         0x7fffffffe218 +------------------+
</span></span><span class=line><span class=cl>                        |                  |
</span></span><span class=line><span class=cl>         0x7fffffffe210 +------------------+
</span></span><span class=line><span class=cl>                        |                  |
</span></span><span class=line><span class=cl>         0x7fffffffe208 +------------------+
</span></span></code></pre></td></tr></table></div></div><h4 id=32-调用caller>3.2 调用caller<a hidden class=anchor aria-hidden=true href=#32-调用caller>#</a></h4><p>寄存器信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33>33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34>34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35>35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36>36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37>37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38>38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39>39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40>40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41>41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42>42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43>43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44>44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45>45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) s
</span></span><span class=line><span class=cl>caller () at stackexample.c:14
</span></span><span class=line><span class=cl>14              int iRet = 0x0;
</span></span><span class=line><span class=cl>(gdb) info registers 
</span></span><span class=line><span class=cl>rax            0x4005e6 4195814
</span></span><span class=line><span class=cl>rbx            0x0      0
</span></span><span class=line><span class=cl>rcx            0x400600 4195840
</span></span><span class=line><span class=cl>rdx            0x7fffffffe518   140737488348440
</span></span><span class=line><span class=cl>rsi            0x7fffffffe508   140737488348424
</span></span><span class=line><span class=cl>rdi            0x1      1
</span></span><span class=line><span class=cl>rbp            0x7fffffffe410   0x7fffffffe410
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3e0   0x7fffffffe3e0
</span></span><span class=line><span class=cl>r8             0x7ffff7dd5e80   140737351868032
</span></span><span class=line><span class=cl>r9             0x0      0
</span></span><span class=line><span class=cl>r10            0x7fffffffe270   140737488347760
</span></span><span class=line><span class=cl>r11            0x7ffff7a3ba00   140737348090368
</span></span><span class=line><span class=cl>r12            0x400440 4195392
</span></span><span class=line><span class=cl>r13            0x7fffffffe500   140737488348416
</span></span><span class=line><span class=cl>r14            0x0      0
</span></span><span class=line><span class=cl>r15            0x0      0
</span></span><span class=line><span class=cl>rip            0x40058a 0x40058a &lt;caller+8&gt;
</span></span><span class=line><span class=cl>eflags         0x202    [ IF ]
</span></span><span class=line><span class=cl>cs             0x33     51
</span></span><span class=line><span class=cl>ss             0x2b     43
</span></span><span class=line><span class=cl>ds             0x0      0
</span></span><span class=line><span class=cl>es             0x0      0
</span></span><span class=line><span class=cl>fs             0x0      0
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
</span></span><span class=line><span class=cl>gs             0x0      0
</span></span><span class=line><span class=cl>(gdb) x /6gx  0x7fffffffe3e0
</span></span><span class=line><span class=cl>0x7fffffffe3e0: 0x0000000000000001      0x000000000040064d
</span></span><span class=line><span class=cl>0x7fffffffe3f0: 0x0000000000000000      0x0000000000000000
</span></span><span class=line><span class=cl>0x7fffffffe400: 0x0000000000400600      0x0000000000400440
</span></span><span class=line><span class=cl>(gdb)
</span></span><span class=line><span class=cl>(gdb) x /12gx  0x7fffffffe3e0
</span></span><span class=line><span class=cl>0x7fffffffe3e0: 0x0000000000000001      0x000000000040064d
</span></span><span class=line><span class=cl>0x7fffffffe3f0: 0x0000000000000000      0x0000000000000000
</span></span><span class=line><span class=cl>0x7fffffffe400: 0x0000000000400600      0x0000000000400440 #小端系统，前8位存储iRet的值
</span></span><span class=line><span class=cl>0x7fffffffe410: 0x00007fffffffe420      0x00000000004005ef
</span></span><span class=line><span class=cl>0x7fffffffe420: 0x0000000000000000      0x00007ffff7a3baf5
</span></span><span class=line><span class=cl>0x7fffffffe430: 0x0000002000000000      0x00007fffffffe508
</span></span><span class=line><span class=cl>(gdb) 
</span></span><span class=line><span class=cl>(gdb) p iRet
</span></span><span class=line><span class=cl>$3 = 0
</span></span><span class=line><span class=cl>(gdb) p &amp;iRet
</span></span><span class=line><span class=cl>$4 = (int *) 0x7fffffffe40c #局部变量在堆栈的位置
</span></span></code></pre></td></tr></table></div></div><p>栈内存（堆栈向下生长）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>rbp            0x7fffffffe410   0x7fffffffe410
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3e0   0x7fffffffe3e0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        0x7fffffffe428 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe420 +------------------+
</span></span><span class=line><span class=cl>                       |0x00000000004005ef| #保存返回main的指令地址,参考汇编代码
</span></span><span class=line><span class=cl>        0x7fffffffe418 +------------------+
</span></span><span class=line><span class=cl>                       |0x00007fffffffe420| #保存main函数对应rbp
</span></span><span class=line><span class=cl> rbp --&gt;0x7fffffffe410 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe408 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe400 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3f8 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3f0 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3e8 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl> rsp --&gt;0x7fffffffe3e0 +------------------+        
</span></span></code></pre></td></tr></table></div></div><p>main函数的汇编代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) disassemble  /m main
</span></span><span class=line><span class=cl>Dump of assembler code for function main:
</span></span><span class=line><span class=cl>21      {
</span></span><span class=line><span class=cl>   0x00000000004005e6 &lt;+0&gt;:     push   %rbp
</span></span><span class=line><span class=cl>   0x00000000004005e7 &lt;+1&gt;:     mov    %rsp,%rbp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>22              caller();
</span></span><span class=line><span class=cl>   0x00000000004005ea &lt;+4&gt;:     callq  0x400582 &lt;caller&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>23
</span></span><span class=line><span class=cl>24              return 0;
</span></span><span class=line><span class=cl>   0x00000000004005ef &lt;+9&gt;:     mov    $0x0,%eax  #调用caller返回后执行的指令地址
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>25      }
</span></span><span class=line><span class=cl>   0x00000000004005f4 &lt;+14&gt;:    pop    %rbp
</span></span><span class=line><span class=cl>   0x00000000004005f5 &lt;+15&gt;:    retq   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><h4 id=33调用sum>3.3调用sum<a hidden class=anchor aria-hidden=true href=#33调用sum>#</a></h4><p>寄存器信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span><span class=lnt id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a>
</span><span class=lnt id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a>
</span><span class=lnt id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a>
</span><span class=lnt id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a>
</span><span class=lnt id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a>
</span><span class=lnt id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a>
</span><span class=lnt id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a>
</span><span class=lnt id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a>
</span><span class=lnt id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a>
</span><span class=lnt id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a>
</span><span class=lnt id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a>
</span><span class=lnt id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a>
</span><span class=lnt id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a>
</span><span class=lnt id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a>
</span><span class=lnt id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a>
</span><span class=lnt id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a>
</span><span class=lnt id=hl-10-29><a class=lnlinks href=#hl-10-29>29</a>
</span><span class=lnt id=hl-10-30><a class=lnlinks href=#hl-10-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Breakpoint 2, sum (a1=17, a2=34, a3=51, a4=68, a5=85, a6=102, a7=119, a8=136, 
</span></span><span class=line><span class=cl>    a9=153) at stackexample.c:6
</span></span><span class=line><span class=cl>6               int s = 0x0;
</span></span><span class=line><span class=cl>(gdb) info  registers 
</span></span><span class=line><span class=cl>rax            0x4005e6 4195814
</span></span><span class=line><span class=cl>rbx            0x0      0
</span></span><span class=line><span class=cl>rcx            0x44     68                             #第四个参数
</span></span><span class=line><span class=cl>rdx            0x33     51                             #第三个参数
</span></span><span class=line><span class=cl>rsi            0x22     34                             #第二个参数
</span></span><span class=line><span class=cl>rdi            0x11     17                             #第一个参数 
</span></span><span class=line><span class=cl>rbp            0x7fffffffe3d0   0x7fffffffe3d0
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3d0   0x7fffffffe3d0
</span></span><span class=line><span class=cl>r8             0x55     85                             #第五个参数 
</span></span><span class=line><span class=cl>r9             0x66     102                            #第六个参数 
</span></span><span class=line><span class=cl>r10            0x7fffffffe270   140737488347760
</span></span><span class=line><span class=cl>r11            0x7ffff7a3ba00   140737348090368
</span></span><span class=line><span class=cl>r12            0x400440 4195392
</span></span><span class=line><span class=cl>r13            0x7fffffffe500   140737488348416
</span></span><span class=line><span class=cl>r14            0x0      0
</span></span><span class=line><span class=cl>r15            0x0      0
</span></span><span class=line><span class=cl>rip            0x400548 0x400548 &lt;sum+24&gt;
</span></span><span class=line><span class=cl>eflags         0x202    [ IF ]
</span></span><span class=line><span class=cl>cs             0x33     51
</span></span><span class=line><span class=cl>ss             0x2b     43
</span></span><span class=line><span class=cl>ds             0x0      0
</span></span><span class=line><span class=cl>es             0x0      0
</span></span><span class=line><span class=cl>fs             0x0      0
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit--- 
</span></span><span class=line><span class=cl>gs             0x0      0
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><p>caller对应汇编代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36>36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37>37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) disassemble   /m caller
</span></span><span class=line><span class=cl>Dump of assembler code for function caller:
</span></span><span class=line><span class=cl>13      {
</span></span><span class=line><span class=cl>   0x0000000000400582 &lt;+0&gt;:     push   %rbp  #保存调用函数main的rbp
</span></span><span class=line><span class=cl>   0x0000000000400583 &lt;+1&gt;:     mov    %rsp,%rbp #将上一个栈顶指针作为本函数的栈底（设置当前函数的栈基址）
</span></span><span class=line><span class=cl>   0x0000000000400586 &lt;+4&gt;:     sub    $0x30,%rsp #分配栈空间
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>14              int iRet = 0x0;
</span></span><span class=line><span class=cl>   0x000000000040058a &lt;+8&gt;:     movl   $0x0,-0x4(%rbp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>15
</span></span><span class=line><span class=cl>16              iRet = sum(0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99);
</span></span><span class=line><span class=cl>   0x0000000000400591 &lt;+15&gt;:    movl   $0x99,0x10(%rsp)   #第9个参数
</span></span><span class=line><span class=cl>   0x0000000000400599 &lt;+23&gt;:    movl   $0x88,0x8(%rsp)    #第8个参考 
</span></span><span class=line><span class=cl>   0x00000000004005a1 &lt;+31&gt;:    movl   $0x77,(%rsp)       #第7个参数
</span></span><span class=line><span class=cl>   0x00000000004005a8 &lt;+38&gt;:    mov    $0x66,%r9d         #第6个参数 
</span></span><span class=line><span class=cl>   0x00000000004005ae &lt;+44&gt;:    mov    $0x55,%r8d         #第5个参数 
</span></span><span class=line><span class=cl>   0x00000000004005b4 &lt;+50&gt;:    mov    $0x44,%ecx         #第4个参数
</span></span><span class=line><span class=cl>   0x00000000004005b9 &lt;+55&gt;:    mov    $0x33,%edx         #第3个参数 
</span></span><span class=line><span class=cl>   0x00000000004005be &lt;+60&gt;:    mov    $0x22,%esi         #第2个参数
</span></span><span class=line><span class=cl>   0x00000000004005c3 &lt;+65&gt;:    mov    $0x11,%edi         #第1个参数 
</span></span><span class=line><span class=cl>   0x00000000004005c8 &lt;+70&gt;:    callq  0x400530 &lt;sum&gt;     #调用函数sum
</span></span><span class=line><span class=cl>   0x00000000004005cd &lt;+75&gt;:    mov    %eax,-0x4(%rbp)    #取返回值
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>17              printf(&#34;sum: %X\r\n&#34;, iRet);
</span></span><span class=line><span class=cl>   0x00000000004005d0 &lt;+78&gt;:    mov    -0x4(%rbp),%eax
</span></span><span class=line><span class=cl>   0x00000000004005d3 &lt;+81&gt;:    mov    %eax,%esi
</span></span><span class=line><span class=cl>   0x00000000004005d5 &lt;+83&gt;:    mov    $0x400690,%edi
</span></span><span class=line><span class=cl>   0x00000000004005da &lt;+88&gt;:    mov    $0x0,%eax
</span></span><span class=line><span class=cl>   0x00000000004005df &lt;+93&gt;:    callq  0x400410 &lt;printf@plt&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>18      }
</span></span><span class=line><span class=cl>   0x00000000004005e4 &lt;+98&gt;:    leaveq                   #出栈处理
</span></span><span class=line><span class=cl>   0x00000000004005e5 &lt;+99&gt;:    retq   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><p>通过上面汇编与寄存器信息，可以了解到函数调用的参数一般先通过寄存器传递。但是可用于传递函数的参数有限，超出的参数怎么传递呢？入调用函数的栈空间，具体如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) x  /12gx  $rsp
</span></span><span class=line><span class=cl>0x7fffffffe3d0: 0x00007fffffffe410      0x00000000004005cd   #main函数栈底，返回指令
</span></span><span class=line><span class=cl>0x7fffffffe3e0: 0x0000000000000077      0x0000000000000088   #第七个参数  第八个参数
</span></span><span class=line><span class=cl>0x7fffffffe3f0: 0x0000000000000099      0x0000000000000000   #第九个参数
</span></span><span class=line><span class=cl>0x7fffffffe400: 0x0000000000400600      0x0000000000400440   #这两个内容是什么
</span></span><span class=line><span class=cl>0x7fffffffe410: 0x00007fffffffe420      0x00000000004005ef
</span></span><span class=line><span class=cl>0x7fffffffe420: 0x0000000000000000      0x00007ffff7a3baf5
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><p>栈内存（栈向下生长）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>rbp            0x7fffffffe3d0   0x7fffffffe3d0
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3d0   0x7fffffffe3d0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        0x7fffffffe428 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe420 +------------------+
</span></span><span class=line><span class=cl>                       |0x00000000004005ef| #保存返回main的地址
</span></span><span class=line><span class=cl>        0x7fffffffe418 +------------------+
</span></span><span class=line><span class=cl>                       |0x00007fffffffe420| #保存main函数对应rbp
</span></span><span class=line><span class=cl>        0x7fffffffe410 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe408 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe400 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3f8 +------------------+
</span></span><span class=line><span class=cl>                       |  0x99            |
</span></span><span class=line><span class=cl>        0x7fffffffe3f0 +------------------+
</span></span><span class=line><span class=cl>                       |  0x88            |
</span></span><span class=line><span class=cl>        0x7fffffffe3e8 +------------------+
</span></span><span class=line><span class=cl>                       |  0x77            |
</span></span><span class=line><span class=cl>        0x7fffffffe3e0 +------------------+    
</span></span><span class=line><span class=cl>                       |0x00000000004005cd| #保存调用caller返回的指令地址
</span></span><span class=line><span class=cl>        0x7fffffffe3e0 +------------------+ 
</span></span><span class=line><span class=cl>                       |0x00007fffffffe410| #保存caller函数对应的rbp
</span></span><span class=line><span class=cl> rsp --&gt;0x7fffffffe3e0 +------------------+ 
</span></span><span class=line><span class=cl>    
</span></span></code></pre></td></tr></table></div></div><h4 id=34-sum获取参数>3.4 sum获取参数<a hidden class=anchor aria-hidden=true href=#34-sum获取参数>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8>8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) x  /16gx $rsp-0x28
</span></span><span class=line><span class=cl>0x7fffffffe3a8: 0x0000005500000066      0x0000003300000044
</span></span><span class=line><span class=cl>0x7fffffffe3b8: 0x0000001100000022      0x0000000000000006
</span></span><span class=line><span class=cl>0x7fffffffe3c8: 0x00000000f7ab9646      0x00007fffffffe410
</span></span><span class=line><span class=cl>0x7fffffffe3d8: 0x00000000004005cd      0x0000000000000077
</span></span><span class=line><span class=cl>0x7fffffffe3e8: 0x0000000000000088      0x0000000000000099
</span></span><span class=line><span class=cl>0x7fffffffe3f8: 0x0000000000000000      0x0000000000400600
</span></span><span class=line><span class=cl>0x7fffffffe408: 0x0000000000400440      0x00007fffffffe420
</span></span><span class=line><span class=cl>0x7fffffffe418: 0x00000000004005ef      0x0000000000000000
</span></span></code></pre></td></tr></table></div></div><p>栈内存（栈向下生长）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41>41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42>42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43>43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44>44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45>45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>rbp            0x7fffffffe3e0   0x7fffffffe3e0
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3e0   0x7fffffffe3e0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        0x7fffffffe428 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe420 +------------------+
</span></span><span class=line><span class=cl>                       |0x00000000004005ef| #保存返回main的地址
</span></span><span class=line><span class=cl>        0x7fffffffe418 +------------------+
</span></span><span class=line><span class=cl>                       |0x00007fffffffe420| #保存main函数对应rbp
</span></span><span class=line><span class=cl>        0x7fffffffe410 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe408 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe400 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3f8 +------------------+
</span></span><span class=line><span class=cl>                       |  0x99            |
</span></span><span class=line><span class=cl>        0x7fffffffe3f0 +------------------+
</span></span><span class=line><span class=cl>                       |  0x88            |
</span></span><span class=line><span class=cl>        0x7fffffffe3e8 +------------------+
</span></span><span class=line><span class=cl>                       |  0x77            |
</span></span><span class=line><span class=cl>        0x7fffffffe3e0 +------------------+    
</span></span><span class=line><span class=cl>                       |0x00000000004005cd| #保存返回caller的指令地址
</span></span><span class=line><span class=cl>        0x7fffffffe3e0 +------------------+ 
</span></span><span class=line><span class=cl>                       |0x00007fffffffe410| #保存caller函数对应的rbp
</span></span><span class=line><span class=cl> rsp --&gt;0x7fffffffe3e0 +------------------+  
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3d8 +------------------+  
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3d0 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3e8 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3e0 +------------------+ 
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3c8 +------------------+  
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3c0 +------------------+
</span></span><span class=line><span class=cl>                       |0x0000001100000022|
</span></span><span class=line><span class=cl>        0x7fffffffe3b8 +------------------+
</span></span><span class=line><span class=cl>                       |0x0000005500000066|
</span></span><span class=line><span class=cl>        0x7fffffffe3b0 +------------------+                                    
</span></span><span class=line><span class=cl>                       |0x0000003300000044|
</span></span><span class=line><span class=cl>        0x7fffffffe3a8 +------------------+
</span></span><span class=line><span class=cl>                       |                  |
</span></span><span class=line><span class=cl>        0x7fffffffe3a0 +------------------+    
</span></span></code></pre></td></tr></table></div></div><p>sum函数对应汇编如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span><span class=lnt id=hl-16-19><a class=lnlinks href=#hl-16-19>19</a>
</span><span class=lnt id=hl-16-20><a class=lnlinks href=#hl-16-20>20</a>
</span><span class=lnt id=hl-16-21><a class=lnlinks href=#hl-16-21>21</a>
</span><span class=lnt id=hl-16-22><a class=lnlinks href=#hl-16-22>22</a>
</span><span class=lnt id=hl-16-23><a class=lnlinks href=#hl-16-23>23</a>
</span><span class=lnt id=hl-16-24><a class=lnlinks href=#hl-16-24>24</a>
</span><span class=lnt id=hl-16-25><a class=lnlinks href=#hl-16-25>25</a>
</span><span class=lnt id=hl-16-26><a class=lnlinks href=#hl-16-26>26</a>
</span><span class=lnt id=hl-16-27><a class=lnlinks href=#hl-16-27>27</a>
</span><span class=lnt id=hl-16-28><a class=lnlinks href=#hl-16-28>28</a>
</span><span class=lnt id=hl-16-29><a class=lnlinks href=#hl-16-29>29</a>
</span><span class=lnt id=hl-16-30><a class=lnlinks href=#hl-16-30>30</a>
</span><span class=lnt id=hl-16-31><a class=lnlinks href=#hl-16-31>31</a>
</span><span class=lnt id=hl-16-32><a class=lnlinks href=#hl-16-32>32</a>
</span><span class=lnt id=hl-16-33><a class=lnlinks href=#hl-16-33>33</a>
</span><span class=lnt id=hl-16-34><a class=lnlinks href=#hl-16-34>34</a>
</span><span class=lnt id=hl-16-35><a class=lnlinks href=#hl-16-35>35</a>
</span><span class=lnt id=hl-16-36><a class=lnlinks href=#hl-16-36>36</a>
</span><span class=lnt id=hl-16-37><a class=lnlinks href=#hl-16-37>37</a>
</span><span class=lnt id=hl-16-38><a class=lnlinks href=#hl-16-38>38</a>
</span><span class=lnt id=hl-16-39><a class=lnlinks href=#hl-16-39>39</a>
</span><span class=lnt id=hl-16-40><a class=lnlinks href=#hl-16-40>40</a>
</span><span class=lnt id=hl-16-41><a class=lnlinks href=#hl-16-41>41</a>
</span><span class=lnt id=hl-16-42><a class=lnlinks href=#hl-16-42>42</a>
</span><span class=lnt id=hl-16-43><a class=lnlinks href=#hl-16-43>43</a>
</span><span class=lnt id=hl-16-44><a class=lnlinks href=#hl-16-44>44</a>
</span><span class=lnt id=hl-16-45><a class=lnlinks href=#hl-16-45>45</a>
</span><span class=lnt id=hl-16-46><a class=lnlinks href=#hl-16-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) disassemble  /m sum 
</span></span><span class=line><span class=cl>Dump of assembler code for function sum:
</span></span><span class=line><span class=cl>5       {
</span></span><span class=line><span class=cl>   0x0000000000400530 &lt;+0&gt;:     push   %rbp
</span></span><span class=line><span class=cl>   0x0000000000400531 &lt;+1&gt;:     mov    %rsp,%rbp
</span></span><span class=line><span class=cl>   0x0000000000400534 &lt;+4&gt;:     mov    %edi,-0x14(%rbp)  #获取函数参数，顺序为从左到右 
</span></span><span class=line><span class=cl>   0x0000000000400537 &lt;+7&gt;:     mov    %esi,-0x18(%rbp)
</span></span><span class=line><span class=cl>   0x000000000040053a &lt;+10&gt;:    mov    %edx,-0x1c(%rbp)
</span></span><span class=line><span class=cl>   0x000000000040053d &lt;+13&gt;:    mov    %ecx,-0x20(%rbp)
</span></span><span class=line><span class=cl>   0x0000000000400540 &lt;+16&gt;:    mov    %r8d,-0x24(%rbp)
</span></span><span class=line><span class=cl>   0x0000000000400544 &lt;+20&gt;:    mov    %r9d,-0x28(%rbp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>6               int s = 0x0;
</span></span><span class=line><span class=cl>   0x0000000000400548 &lt;+24&gt;:    movl   $0x0,-0x4(%rbp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>7               s = a1+a2+a3+a4+a5+a6+a7+a8+a9;
</span></span><span class=line><span class=cl>=&gt; 0x000000000040054f &lt;+31&gt;:    mov    -0x18(%rbp),%eax
</span></span><span class=line><span class=cl>   0x0000000000400552 &lt;+34&gt;:    mov    -0x14(%rbp),%edx
</span></span><span class=line><span class=cl>   0x0000000000400555 &lt;+37&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x0000000000400557 &lt;+39&gt;:    mov    -0x1c(%rbp),%eax
</span></span><span class=line><span class=cl>   0x000000000040055a &lt;+42&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x000000000040055c &lt;+44&gt;:    mov    -0x20(%rbp),%eax
</span></span><span class=line><span class=cl>   0x000000000040055f &lt;+47&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x0000000000400561 &lt;+49&gt;:    mov    -0x24(%rbp),%eax
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
</span></span><span class=line><span class=cl>   0x0000000000400564 &lt;+52&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x0000000000400566 &lt;+54&gt;:    mov    -0x28(%rbp),%eax
</span></span><span class=line><span class=cl>   0x0000000000400569 &lt;+57&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x000000000040056b &lt;+59&gt;:    mov    0x10(%rbp),%eax #取参数a7 = 0x77
</span></span><span class=line><span class=cl>   0x000000000040056e &lt;+62&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x0000000000400570 &lt;+64&gt;:    mov    0x18(%rbp),%eax #取参数a8 = 0x88 
</span></span><span class=line><span class=cl>   0x0000000000400573 &lt;+67&gt;:    add    %eax,%edx
</span></span><span class=line><span class=cl>   0x0000000000400575 &lt;+69&gt;:    mov    0x20(%rbp),%eax #取参数a9 = 0x99
</span></span><span class=line><span class=cl>   0x0000000000400578 &lt;+72&gt;:    add    %edx,%eax
</span></span><span class=line><span class=cl>   0x000000000040057a &lt;+74&gt;:    mov    %eax,-0x4(%rbp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>8
</span></span><span class=line><span class=cl>9               return s;
</span></span><span class=line><span class=cl>   0x000000000040057d &lt;+77&gt;:    mov    -0x4(%rbp),%eax #计算结果通过eax寄存器返回
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10      }
</span></span><span class=line><span class=cl>   0x0000000000400580 &lt;+80&gt;:    pop    %rbp
</span></span><span class=line><span class=cl>   0x0000000000400581 &lt;+81&gt;:    retq   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>End of assembler dump.
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><p>注意的是调用sum的时候并没有分配栈空间？主要原因是sum函数内没有调用其他函数，sum就只能被别的函数调用，sum的局部变量直接由rsp向下生长，调用结束后，直接恢复调用者的栈，这样的好处有两个：</p><ol><li>少一个指令，提高执行效率</li><li>编译的时候并不需要计算需要开辟多少栈空间</li></ol><p>为什么需要将值从寄存器取出？直接利用寄存器取值不可以吗？
传递参数的寄存器在函数执行指令的时候有其他用处，调用函数需要将参数从寄存器取出到栈内存中（在一定的情况下即调用函数的指令不需要占用传递参数的寄存器，如果加大编译的优化级别，是否不会从参数寄存器取出参数到函数的栈内存中而是直接使用寄存器？）另外可以从这里看出，从代码层面优化性能可以考虑减少函数调用以及优化一些不必要的参数传递，尽管只能尽一丝绵薄之力。</p><h4 id=35-sum返回值>3.5 sum返回值<a hidden class=anchor aria-hidden=true href=#35-sum返回值>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span><span class=lnt id=hl-17-34><a class=lnlinks href=#hl-17-34>34</a>
</span><span class=lnt id=hl-17-35><a class=lnlinks href=#hl-17-35>35</a>
</span><span class=lnt id=hl-17-36><a class=lnlinks href=#hl-17-36>36</a>
</span><span class=lnt id=hl-17-37><a class=lnlinks href=#hl-17-37>37</a>
</span><span class=lnt id=hl-17-38><a class=lnlinks href=#hl-17-38>38</a>
</span><span class=lnt id=hl-17-39><a class=lnlinks href=#hl-17-39>39</a>
</span><span class=lnt id=hl-17-40><a class=lnlinks href=#hl-17-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) n
</span></span><span class=line><span class=cl>caller () at stackexample.c:17
</span></span><span class=line><span class=cl>17              printf(&#34;sum: %X\r\n&#34;, iRet);
</span></span><span class=line><span class=cl>(gdb) info registers 
</span></span><span class=line><span class=cl>rax            0x2fd    765  #返回值 
</span></span><span class=line><span class=cl>rbx            0x0      0
</span></span><span class=line><span class=cl>rcx            0x44     68
</span></span><span class=line><span class=cl>rdx            0x264    612
</span></span><span class=line><span class=cl>rsi            0x22     34
</span></span><span class=line><span class=cl>rdi            0x11     17
</span></span><span class=line><span class=cl>rbp            0x7fffffffe410   0x7fffffffe410
</span></span><span class=line><span class=cl>rsp            0x7fffffffe3e0   0x7fffffffe3e0
</span></span><span class=line><span class=cl>r8             0x55     85
</span></span><span class=line><span class=cl>r9             0x66     102
</span></span><span class=line><span class=cl>r10            0x7fffffffe270   140737488347760
</span></span><span class=line><span class=cl>r11            0x7ffff7a3ba00   140737348090368
</span></span><span class=line><span class=cl>r12            0x400440 4195392
</span></span><span class=line><span class=cl>r13            0x7fffffffe500   140737488348416
</span></span><span class=line><span class=cl>r14            0x0      0
</span></span><span class=line><span class=cl>r15            0x0      0
</span></span><span class=line><span class=cl>rip            0x4005d0 0x4005d0 &lt;caller+78&gt;
</span></span><span class=line><span class=cl>eflags         0x202    [ IF ]
</span></span><span class=line><span class=cl>cs             0x33     51
</span></span><span class=line><span class=cl>ss             0x2b     43
</span></span><span class=line><span class=cl>ds             0x0      0
</span></span><span class=line><span class=cl>es             0x0      0
</span></span><span class=line><span class=cl>fs             0x0      0
</span></span><span class=line><span class=cl>---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
</span></span><span class=line><span class=cl>gs             0x0      0
</span></span><span class=line><span class=cl>(gdb) 
</span></span><span class=line><span class=cl>(gdb) x /16gx 0x7fffffffe3c0 
</span></span><span class=line><span class=cl>0x7fffffffe3c0: 0x0000000000000006      0x000002fdf7ab9646  #返回值0x2fd
</span></span><span class=line><span class=cl>0x7fffffffe3d0: 0x00007fffffffe410      0x00000000004005cd
</span></span><span class=line><span class=cl>0x7fffffffe3e0: 0x0000000000000077      0x0000000000000088
</span></span><span class=line><span class=cl>0x7fffffffe3f0: 0x0000000000000099      0x0000000000000000
</span></span><span class=line><span class=cl>0x7fffffffe400: 0x0000000000400600      0x000002fd00400440
</span></span><span class=line><span class=cl>0x7fffffffe410: 0x00007fffffffe420      0x00000000004005ef
</span></span><span class=line><span class=cl>0x7fffffffe420: 0x0000000000000000      0x00007ffff7a3baf5
</span></span><span class=line><span class=cl>0x7fffffffe430: 0x0000002000000000      0x00007fffffffe508
</span></span><span class=line><span class=cl>(gdb) 
</span></span></code></pre></td></tr></table></div></div><h3 id=x86-64寄存器说明>x86-64寄存器说明<a hidden class=anchor aria-hidden=true href=#x86-64寄存器说明>#</a></h3><ol><li>rsp：对应32位esp寄存器，保存当前堆栈栈顶指针的寄存器</li><li>rbp：对应32位ebp寄存器，保存了当前堆栈基地址指针的寄存器</li><li>rax: 临时寄存器，当我们调用系统调用的时候，rax保外系统调用号</li><li>rdx：传递第3个参数到函数</li><li>rdi：传递第1个参数到函数</li><li>rsi：传递第2个参数到函数</li><li>rip: 下一个执行指令地址</li></ol><h3 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h3><ol><li><a href=https://en.wikipedia.org/wiki/Calling_convention#x86>Calling_convention</a></li><li><a href=http://sourceware.org/gdb/news/reversible.html>GDB and Reverse Debugging</a></li><li><a href=http://0xax.blogspot.sg/p/assembly-x8664-programming-for-linux.html>Assembly x86_64 programming for Linux</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://myself659.github.io/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://myself659.github.io/post/2016-04-17-linux-kernel-crashs/><span class=title>« 上一页</span><br><span>Linux内核常见crash原因</span></a>
<a class=next href=https://myself659.github.io/post/2016-03-05-do-more-than-coding/><span class=title>下一页 »</span><br><span>代码是核心，但不仅仅是代码</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on twitter" href="https://twitter.com/intent/tweet/?text=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f&amp;hashtags=Linux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f&amp;title=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90&amp;summary=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90&amp;source=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f&title=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on whatsapp" href="https://api.whatsapp.com/send?text=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90%20-%20https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Linux x86-64 函数调用栈实例分析 on telegram" href="https://telegram.me/share/url?text=Linux%20x86-64%20%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e6%a0%88%e5%ae%9e%e4%be%8b%e5%88%86%e6%9e%90&amp;url=https%3a%2f%2fmyself659.github.io%2fpost%2f2016-03-09-x86-64-call-stack%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://myself659.github.io/>沉风网事</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>